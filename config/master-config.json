{
  "$schema": "./schema/cycle-schema.json",
  "$comment": "Master configuration - validated against cycle schema structure",
  "version": "3.1.0",
  "lastUpdated": "2025-12-09",

  "_AI_INSTRUCTION": {
    "priority": "CRITICAL",
    "message": "All content generation MUST comply with complianceRequirements below and align with Scholarly Foundations document",
    "scholarlyFoundationsPath": "Scholarly Foundations for NGSS-Aligned Middle School Science Curriculum Development.md"
  },

  "complianceRequirements": {
    "materialsPolicy": {
      "rule": "DIGITAL_FIRST_NOTECARD_ONLY",
      "description": "All instructional materials must be digital-hosted in this repository",
      "physicalMaterialsAllowed": "ONE notecard (3x5 or 4x6) per student per class period",
      "rationale": {
        "digitalNotebooks": "Î³ = 0.34 learning improvement (Rappolt-Schlichtmann et al., 2013)",
        "virtualLabs": "g = 0.686 positive outcomes (2024 PLOS ONE)",
        "accessibility": "100% async access, UDL supports, MTSS monitoring"
      },
      "prohibited": ["physical lab materials", "printed worksheets", "textbooks", "manipulatives"]
    },
    "researchAlignment": {
      "interleaving": { "effectSize": "d = 0.83", "requirement": "2 spiral questions per exit ticket" },
      "retrievalPractice": { "effectSize": "g = 0.50-0.61", "requirement": "Weekly retrieval in all assessments" },
      "refutationalText": { "effectSize": "g = 0.41", "requirement": "Use for all misconception feedback" },
      "activeLearning": { "effectSize": "33-45% gap reduction", "requirement": ">67% active learning time" },
      "lightGuidance": { "effectSize": "85% vs 9% exploration", "requirement": "Driving questions, not step-by-step" },
      "spacing": { "rule": "10-20% of retention interval", "requirement": "Revisit concepts every 2-3 weeks" }
    },
    "ngssAlignment": {
      "threeDimensional": true,
      "phenomenonDriven": true,
      "cccsAsEquityEntryPoints": true,
      "fiveInstructionalRoutines": ["elicitQuestions", "navigateInvestigations", "problematize", "synthesize", "revisitPhenomenon"]
    }
  },

  "school": {
    "name": "KAMS",
    "fullName": "Knowledge Academy Middle School",
    "academicYear": "2025-2026"
  },

  "grades": {
    "7": {
      "name": "Grade 7",
      "subject": "Life & Earth Science",
      "periods": ["Period 2", "Period 7"],
      "studentCount": 60
    },
    "8": {
      "name": "Grade 8",
      "subject": "Physical Science",
      "periods": ["Period 3", "Period 5"],
      "studentCount": 55
    }
  },

  "cycles": {
    "range": {
      "start": 1,
      "end": 8,
      "_note": "SY25-26 full calendar: C1-C8. C2 is legacy pre-architecture."
    },
    "totalCycles": 8,
    "weeksPerCycle": {
      "_note": "Week counts vary by cycle per official Kairos SY25-26 calendar",
      "cycle01": 8,
      "cycle02": 5,
      "cycle03": 3,
      "cycle04": 6,
      "cycle05": 3,
      "cycle06": 5,
      "cycle07": 4,
      "cycle08": 4
    },
    "totalInstructionalWeeks": 38,
    "pointsPerWeek": 100,
    "formsPerWeek": 5,
    "_calendarAlignment": {
      "source": "Kairos_SY25-26_Calendar.md",
      "lastVerified": "2025-12-11",
      "note": "C9-C10 standards integrated into C8; configs archived to archive/deferred-cycles/"
    }
  },

  "assessment": {
    "formStructure": {
      "hook": {
        "points": 12,
        "duration": 10,
        "autoGradedPercent": 25,
        "questionCount": 5
      },
      "station1": {
        "points": 20,
        "duration": 18,
        "autoGradedPercent": 50,
        "questionCount": 6
      },
      "station2": {
        "points": 20,
        "duration": 15,
        "autoGradedPercent": 40,
        "questionCount": 5
      },
      "station3": {
        "points": 25,
        "duration": 20,
        "autoGradedPercent": 0,
        "questionCount": 5
      },
      "exitTicket": {
        "points": 23,
        "duration": 15,
        "autoGradedPercent": 35,
        "questionCount": 6
      }
    },
    "questionTypes": {
      "autoGradable": ["multipleChoice", "checkbox", "dropdown", "scale", "grid"],
      "manualGrading": ["paragraph", "shortAnswer", "fileUpload"],
      "diagnostic": ["confidence", "selfAssessment"]
    },
    "spiralStructure": {
      "questionsPerExit": 2,
      "integrationQuestions": 1,
      "sep1Questions": 1
    },
    "targetAutoGradedPercent": {
      "min": 30,
      "max": 40
    }
  },

  "rubrics": {
    "scales": {
      "standard": [5, 4, 3, 2, 1, 0],
      "simplified": [4, 3, 2, 1, 0],
      "binary": [1, 0]
    },
    "requirements": [
      "Observable behaviors only",
      "No subjective language",
      "Example responses for each level",
      "Distractor analysis for common errors"
    ]
  },

  "mtss": {
    "tiers": {
      "1": {
        "name": "Universal",
        "scoreRange": { "min": 70, "max": 100 },
        "intervention": "Core instruction with standard differentiation"
      },
      "2": {
        "name": "Targeted",
        "scoreRange": { "min": 50, "max": 69 },
        "intervention": "Small group reteach, peer tutoring, modified assignments"
      },
      "3": {
        "name": "Intensive",
        "scoreRange": { "min": 0, "max": 49 },
        "intervention": "1:1 intervention, alternative assessment, extended time"
      }
    },
    "alerts": {
      "misconceptionThreshold": 30,
      "criticalMisconceptionThreshold": 50,
      "wholeClassReteachThreshold": 40,
      "spiralEffectivenessMin": 60
    },
    "misconceptionTracking": {
      "trackingWindowWeeks": 3
    },
    "spiral": {
      "improvementTarget": 10,
      "questionsPerExit": 2
    },
    "grouping": {
      "maxTier2GroupSize": 5,
      "maxTier3GroupSize": 3,
      "minGroupSize": 2,
      "similarityThreshold": 0.6,
      "priorityStandards": ["SEP-2", "SEP-4", "DCI-LS2.B", "DCI-ESS3.C"]
    },
    "dataRefreshInterval": "daily",
    "reportFormats": ["json", "csv", "xlsx"]
  },

  "seating": {
    "enabled": true,
    "classroom": {
      "layout": "perimeter",
      "totalSeats": 24,
      "walls": {
        "north": { "seats": [1, 2, 3, 4, 5, 6], "label": "Front (Whiteboard)" },
        "east": { "seats": [7, 8, 9, 10, 11, 12], "label": "Windows" },
        "south": { "seats": [13, 14, 15, 16, 17, 18], "label": "Back" },
        "west": { "seats": [19, 20, 21, 22, 23, 24], "label": "Hallway" }
      }
    },
    "analysis": {
      "minWeeksForCorrelation": 3,
      "adjacencyDistance": 2,
      "correlationThresholds": {
        "catalystPair": 0.5,
        "distractionVector": -0.4
      },
      "confidenceLevels": {
        "high": { "minDataPoints": 20, "minBalance": 0.5 },
        "medium": { "minDataPoints": 10, "minBalance": 0.3 }
      }
    },
    "optimization": {
      "weights": {
        "peerTutoring": 1.5,
        "tierClusteringPenalty": 2.0,
        "catalystBonus": 2.0,
        "distractionPenalty": 3.0
      },
      "tierPlacement": {
        "tier3": "front",
        "tier2": "sides",
        "tier1": "flexible"
      }
    },
    "printables": {
      "signInCard": "archive/experimental/printables/seat-signin-card.html",
      "seatingMap": "archive/experimental/printables/classroom-seating-map.html",
      "insightsReport": "archive/experimental/printables/seating-insights-report.html",
      "dataEntry": "archive/experimental/printables/signin-data-entry.html"
    }
  },

  "platforms": {
    "lms": {
      "name": "Canvas",
      "integration": "LTI",
      "gradebookSync": "manual"
    },
    "forms": {
      "name": "Google Forms",
      "apiVersion": "FormApp",
      "responseStorage": "Google Sheets"
    },
    "data": {
      "aggregation": "Google Sheets + Apps Script",
      "analysis": "JSON export",
      "visualization": "Google Sheets charts"
    }
  },

  "formSettings": {
    "security": {
      "requireLogin": true,
      "collectEmail": true,
      "limitOneResponse": true,
      "allowEdits": true
    },
    "display": {
      "progressBar": true,
      "shuffleQuestions": false,
      "confirmationMessage": "Your response has been recorded. You may edit until the due date."
    },
    "manualConfig": [
      "Release grade timing",
      "Feedback visibility options",
      "Shuffle question order (if needed)"
    ]
  },

  "fileNaming": {
    "directories": "lowercase with leading zeros (cycle03, week1)",
    "configFiles": "lowercase-hyphenated.json",
    "scripts": "PascalCase.gs",
    "templates": "PascalCase-template.ext",
    "contentDocs": "lowercase-hyphenated.md",
    "htmlPages": "lowercase-hyphenated.html",
    "outputJson": "descriptive-lowercase.json"
  },

  "formNaming": {
    "pattern": "G{grade}.C{cycle}.W{week}: {station} - {title}",
    "example": "G7.C3.W1: Hook - The Hot Car Mystery",
    "_note": "Points are tracked in form description and config, not in form title"
  },

  "questionIds": {
    "pattern": "g{grade}_c{cycle}_w{week}_{station}_q{number}",
    "example": "g7_c3_w1_hook_q1"
  },

  "integrations": {
    "alertSystem": {
      "enabled": true,
      "emailNotifications": {
        "enabled": true,
        "recipientEmail": null,
        "_note": "Set to teacher's email address; null uses Session.getActiveUser()"
      },
      "alertThresholds": {
        "mtss": {
          "tier3CountWarning": 3,
          "tier3CountCritical": 5,
          "suddenDropPercent": 15
        },
        "misconception": {
          "singleConceptWarning": 40,
          "singleConceptCritical": 60,
          "persistentWeeks": 2
        },
        "spiral": {
          "effectivenessWarning": 50,
          "effectivenessCritical": 40,
          "retentionDropWarning": 20
        }
      },
      "digestSchedule": {
        "frequency": "daily",
        "time": "16:00",
        "timezone": "America/Chicago",
        "batchWarnings": true,
        "immediateCritical": true
      },
      "deduplicationHours": 24
    },

    "spiralContentAdvisor": {
      "enabled": true,
      "recommendationLimits": {
        "maxUrgentConcepts": 3,
        "maxWeakRetention": 5,
        "maxSuggestedQuestions": 6
      },
      "priorityWeights": {
        "persistentMisconception": 3,
        "recentDrop": 2,
        "lowRetention": 1.5,
        "crossCyclePersistence": 2.5
      },
      "crossCycleAnalysis": {
        "lookbackCycles": 2,
        "minimumDataPoints": 3
      }
    },

    "insightsDashboard": {
      "enabled": true,
      "sections": {
        "systemHealth": true,
        "mtssSummary": true,
        "misconceptionPatterns": true,
        "spiralHealth": true,
        "interventionStatus": true,
        "seatingInsights": true,
        "crossGradePatterns": true,
        "prioritizedActions": true
      },
      "actionPrioritization": {
        "maxHighPriority": 5,
        "maxMediumPriority": 10,
        "autoGenerateRecommendations": true
      },
      "outputFormat": {
        "includeTimestamp": true,
        "formatForEmail": true,
        "includeTrendIndicators": true
      }
    },

    "interventionTracker": {
      "enabled": true,
      "evaluationCriteria": {
        "graduateThreshold": 70,
        "minimumWeeksBeforeGraduation": 2,
        "consecutiveWeeksRequired": 2,
        "escalationAfterWeeks": 3,
        "minimumImprovementPercent": 10
      },
      "interventionTypes": {
        "peerTutoring": {
          "targetTiers": [2],
          "minDurationWeeks": 2,
          "maxGroupSize": 2
        },
        "smallGroupReteach": {
          "targetTiers": [2, 3],
          "minDurationWeeks": 1,
          "maxGroupSize": 5
        },
        "oneOnOne": {
          "targetTiers": [3],
          "minDurationWeeks": 2,
          "maxGroupSize": 1
        },
        "modifiedAssessment": {
          "targetTiers": [2, 3],
          "minDurationWeeks": 1
        },
        "extendedTime": {
          "targetTiers": [2, 3],
          "minDurationWeeks": 1
        }
      },
      "reportGeneration": {
        "frequency": "weekly",
        "includeSuccessStories": true,
        "includeConcerns": true,
        "trackEffectivenessMetrics": true
      }
    },

    "canvasSync": {
      "enabled": false,
      "_note": "Set enabled to true and configure API credentials to activate",
      "apiConfig": {
        "baseUrl": null,
        "apiToken": null,
        "_tokenNote": "Store token in Script Properties as 'CANVAS_API_TOKEN'",
        "courseIds": {
          "grade7": null,
          "grade8": null
        }
      },
      "syncOptions": {
        "pullRoster": true,
        "pullAssignments": true,
        "pullSubmissions": true,
        "crossReferenceWithForms": true
      },
      "rosterSync": {
        "frequency": "weekly",
        "detectNewStudents": true,
        "detectDroppedStudents": true
      },
      "assignmentMapping": {
        "matchByName": true,
        "matchByDate": true,
        "fuzzyMatchThreshold": 0.8
      },
      "missingWorkReport": {
        "enabled": true,
        "includePartialSubmissions": true,
        "daysLookback": 14
      }
    },

    "seatingDataBridge": {
      "enabled": true,
      "tierIntegration": {
        "useMtssTiers": true,
        "tier3Placement": "front",
        "tier2Placement": "sides",
        "tier1Placement": "flexible"
      },
      "peerTutoringConstraints": {
        "applyToSeating": true,
        "keepPairsTogether": true,
        "maxDistance": 2
      },
      "optimizationWeights": {
        "tierPlacement": 2.0,
        "peerTutoringProximity": 1.5,
        "catalystPairBonus": 2.0,
        "distractionVectorPenalty": 3.0,
        "interventionGroupProximity": 1.0
      },
      "constraints": {
        "maxTier3Clustering": 2,
        "minTier1Spread": 3
      }
    },

    "autoCycleDetection": {
      "enabled": true,
      "source": "config/cycles/",
      "fallbackToManual": true,
      "transitionAlerts": {
        "enabled": true,
        "daysBeforeTransition": 3,
        "alertOnWeekChange": true,
        "alertOnCycleChange": true
      }
    }
  },

  "orchestration": {
    "enhancedPipeline": {
      "enabled": true,
      "steps": [
        { "name": "responseCollection", "critical": true, "order": 1 },
        { "name": "dataAggregation", "critical": true, "order": 2 },
        { "name": "mtssAnalysis", "critical": true, "order": 3 },
        { "name": "misconceptionAnalysis", "critical": false, "order": 4 },
        { "name": "spiralEffectiveness", "critical": false, "order": 5 },
        { "name": "interventionGrouping", "critical": false, "order": 6 },
        { "name": "spiralRecommendations", "critical": false, "order": 7 },
        { "name": "recordInterventions", "critical": false, "order": 8 },
        { "name": "evaluateInterventions", "critical": false, "order": 9 },
        { "name": "seatingDataBridge", "critical": false, "order": 10 },
        { "name": "seatingConstraints", "critical": false, "order": 11 },
        { "name": "hubUpdate", "critical": false, "order": 12 },
        { "name": "alertSystem", "critical": false, "order": 13 },
        { "name": "insightsDashboard", "critical": false, "order": 14 },
        { "name": "effectivenessReport", "critical": false, "order": 15 }
      ]
    },
    "scheduling": {
      "dailyOrchestration": {
        "enabled": true,
        "time": "17:00",
        "timezone": "America/Chicago",
        "function": "runEnhancedOrchestration"
      },
      "weeklyFullOrchestration": {
        "enabled": true,
        "dayOfWeek": "Friday",
        "time": "15:00",
        "timezone": "America/Chicago",
        "function": "runWeeklyFullOrchestration"
      },
      "healthCheck": {
        "enabled": true,
        "frequency": "daily",
        "time": "08:00",
        "function": "checkIntegratedSystemHealth"
      }
    },
    "errorHandling": {
      "continueOnNonCritical": true,
      "maxRetries": 2,
      "alertOnFailure": true
    }
  },

  "activeCycles": ["cycle03", "cycle04"],
  "plannedCycles": ["cycle01", "cycle05", "cycle06", "cycle07", "cycle08"],
  "legacyCycles": ["cycle02"],

  "_deferredCycles": {
    "status": "RESOLVED",
    "resolution": "2025-12-10",
    "details": {
      "cycle09": {
        "status": "deferred",
        "reason": "No SY25-26 calendar slot available",
        "standardsResolution": "MS-ESS1-2 and MS-ETS1-2 integrated into Cycle 8",
        "targetYear": "SY26-27 (if calendar permits)"
      },
      "cycle10": {
        "status": "merged",
        "reason": "Year-end activities consolidated",
        "resolution": "Content merged into Cycle 8 Week 3",
        "targetYear": "N/A - resolved"
      }
    },
    "_warning": "Config files for C9-C10 archived to archive/deferred-cycles/ (not in config/cycles/)."
  }
}
