<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive ocean acidification simulation showing how CO‚ÇÇ affects ocean pH and marine life">
    <title>Ocean Acidification Simulator | G7 C4 W1</title>
    <!--
    ================================================================================
    Ocean Acidification Simulator
    ================================================================================
    Interactive simulation demonstrating:
    - CO‚ÇÇ dissolution in seawater
    - pH changes over time (1800-2100)
    - Effects on calcifying marine organisms
    - Chemical reaction: CO‚ÇÇ + H‚ÇÇO ‚Üí H‚ÇÇCO‚ÇÉ ‚Üí H‚Å∫ + HCO‚ÇÉ‚Åª

    Part of Grade 7 Cycle 4 Week 1: Ocean Acidification Investigation
    Standards: MS-ESS3-3 (Monitoring Human Impact)
    ================================================================================
    -->
    <style>
        :root {
            --primary: #0891B2;
            --primary-dark: #0E7490;
            --primary-light: #ECFEFF;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --error: #EF4444;
            --error-light: #FEE2E2;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-700: #374151;
            --gray-900: #111827;
            --text: #1E293B;
            --text-muted: #64748B;
            --radius: 12px;
            --radius-sm: 8px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0E7490 0%, #164E63 100%);
            min-height: 100vh;
            padding: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            font-size: clamp(1.4em, 4vw, 2em);
            margin-bottom: 8px;
        }

        .subtitle {
            color: rgba(255,255,255,0.85);
            text-align: center;
            font-size: clamp(0.9em, 2.5vw, 1.1em);
            margin-bottom: 20px;
        }

        .sim-container {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        /* Instructions */
        .instructions {
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            margin-bottom: 20px;
        }

        .instructions summary {
            padding: 14px 18px;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary-dark);
            list-style: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instructions summary::-webkit-details-marker { display: none; }

        .instructions[open] summary { border-bottom: 1px solid rgba(8,145,178,0.2); }

        .instructions-content {
            padding: 16px 18px;
            font-size: 0.95em;
            line-height: 1.7;
            color: var(--gray-700);
        }

        .instructions-content ol { padding-left: 20px; }
        .instructions-content li { margin-bottom: 8px; }

        /* Main Simulation Grid */
        .sim-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 700px) {
            .sim-grid { grid-template-columns: 1fr; }
        }

        /* Control Panel */
        .control-panel {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid var(--gray-200);
        }

        .control-panel h3 {
            color: var(--primary-dark);
            margin-bottom: 16px;
            font-size: 1.1em;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .control-value {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--gray-200);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .year-markers {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* pH Display */
        .ph-display {
            background: linear-gradient(135deg, #1E3A5F 0%, #0F172A 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
            text-align: center;
            margin-bottom: 16px;
        }

        .ph-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .ph-value {
            font-size: 3em;
            font-weight: 700;
            color: white;
            font-family: 'Courier New', monospace;
        }

        .ph-change {
            font-size: 0.95em;
            margin-top: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .ph-change.negative {
            background: rgba(239,68,68,0.2);
            color: #FCA5A5;
        }

        .ph-change.neutral {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
        }

        /* pH Scale Visual */
        .ph-scale {
            background: linear-gradient(to right, #EF4444 0%, #F59E0B 30%, #10B981 50%, #3B82F6 70%, #8B5CF6 100%);
            height: 20px;
            border-radius: 10px;
            position: relative;
            margin: 16px 0 8px 0;
        }

        .ph-marker {
            position: absolute;
            top: -8px;
            width: 4px;
            height: 36px;
            background: white;
            border: 2px solid var(--gray-900);
            border-radius: 2px;
            transition: left 0.3s ease;
        }

        .ph-scale-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            color: var(--text-muted);
        }

        /* Ocean Visualization */
        .ocean-viz {
            background: linear-gradient(180deg, #87CEEB 0%, #0077BE 30%, #005A8C 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
            min-height: 300px;
            position: relative;
            overflow: hidden;
        }

        .ocean-surface {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(180deg, rgba(135,206,235,0.8) 0%, transparent 100%);
        }

        /* CO2 Bubbles */
        .bubble {
            position: absolute;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            animation: rise 3s infinite ease-in;
        }

        @keyframes rise {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-250px) scale(0.5); opacity: 0; }
        }

        /* Marine Organisms */
        .organisms-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            position: relative;
            z-index: 10;
            margin-top: 60px;
        }

        .organism-card {
            background: rgba(255,255,255,0.95);
            border-radius: var(--radius-sm);
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .organism-card.healthy {
            border: 3px solid var(--success);
        }

        .organism-card.stressed {
            border: 3px solid var(--warning);
        }

        .organism-card.critical {
            border: 3px solid var(--error);
            animation: pulse-danger 1s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239,68,68,0); }
        }

        .organism-emoji {
            font-size: 2.5em;
            margin-bottom: 4px;
            transition: filter 0.3s ease;
        }

        .organism-card.critical .organism-emoji {
            filter: grayscale(50%);
        }

        .organism-name {
            font-weight: 600;
            font-size: 0.85em;
            color: var(--gray-700);
        }

        .organism-threshold {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .organism-status {
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 6px;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .status-healthy {
            background: var(--success-light);
            color: #065F46;
        }

        .status-stressed {
            background: var(--warning-light);
            color: #92400E;
        }

        .status-critical {
            background: var(--error-light);
            color: #991B1B;
        }

        /* Chemical Reaction */
        .reaction-box {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 20px;
        }

        .reaction-box h4 {
            color: var(--primary-dark);
            margin-bottom: 12px;
            font-size: 0.95em;
        }

        .reaction-equation {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
        }

        .molecule {
            background: white;
            padding: 8px 14px;
            border-radius: 8px;
            border: 2px solid var(--gray-300);
            font-weight: 600;
        }

        .molecule.co2 { border-color: var(--gray-500); background: #F3F4F6; }
        .molecule.h2o { border-color: #3B82F6; background: #EFF6FF; }
        .molecule.h2co3 { border-color: #F59E0B; background: #FFFBEB; }
        .molecule.h-ion { border-color: #EF4444; background: #FEF2F2; }
        .molecule.hco3 { border-color: #8B5CF6; background: #F5F3FF; }

        .arrow { font-size: 1.5em; color: var(--gray-500); }

        .reaction-note {
            text-align: center;
            font-size: 0.85em;
            color: var(--text-muted);
            margin-top: 12px;
        }

        /* Info Panels */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (max-width: 550px) {
            .info-grid { grid-template-columns: 1fr; }
        }

        .info-card {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 14px;
            border-left: 4px solid var(--primary);
        }

        .info-card h5 {
            color: var(--primary-dark);
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .info-card p {
            font-size: 0.9em;
            color: var(--gray-700);
            line-height: 1.5;
        }

        .info-card .big-number {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary);
        }

        /* Key Concepts */
        .concept-box {
            background: linear-gradient(135deg, var(--primary-light) 0%, #CFFAFE 100%);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
        }

        .concept-box h4 {
            color: var(--primary-dark);
            margin-bottom: 14px;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (max-width: 550px) {
            .concept-grid { grid-template-columns: 1fr; }
        }

        .concept-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 14px;
        }

        .concept-card h5 {
            font-size: 0.9em;
            color: var(--gray-900);
            margin-bottom: 6px;
        }

        .concept-card p {
            font-size: 0.85em;
            color: var(--gray-700);
            line-height: 1.5;
        }

        /* Quiz Section */
        .quiz-section {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 2px solid var(--gray-200);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .quiz-header h4 {
            color: var(--gray-900);
        }

        .reset-btn {
            background: var(--gray-200);
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            color: var(--gray-700);
        }

        .reset-btn:hover { background: var(--gray-300); }

        .quiz-question {
            margin-bottom: 16px;
        }

        .quiz-question p {
            margin-bottom: 12px;
            color: var(--gray-700);
            line-height: 1.6;
        }

        .quiz-options {
            display: grid;
            gap: 8px;
        }

        .quiz-btn {
            background: white;
            border: 2px solid var(--gray-300);
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 0.95em;
            transition: all 0.2s ease;
        }

        .quiz-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .quiz-btn.correct {
            background: var(--success-light);
            border-color: var(--success);
            color: #065F46;
        }

        .quiz-btn.incorrect {
            background: var(--error-light);
            border-color: var(--error);
            color: #991B1B;
        }

        .quiz-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .quiz-feedback {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.6;
            display: none;
        }

        .quiz-feedback.show { display: block; }

        .quiz-feedback.correct {
            background: var(--success-light);
            color: #065F46;
        }

        .quiz-feedback.incorrect {
            background: var(--error-light);
            color: #991B1B;
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        button:focus, input:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        /* Print */
        @media print {
            body { background: white; padding: 0; }
            .sim-container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Ocean Acidification Simulator</h1>
        <p class="subtitle">Explore how CO‚ÇÇ affects ocean chemistry and marine life</p>

        <div class="sim-container">
            <!-- Instructions -->
            <details class="instructions" open>
                <summary role="button" aria-expanded="true">üìã How to Use This Simulation</summary>
                <div class="instructions-content">
                    <ol>
                        <li><strong>Adjust the year slider</strong> to travel through time (1800 ‚Üí 2100)</li>
                        <li><strong>Watch the pH change</strong> as atmospheric CO‚ÇÇ increases</li>
                        <li><strong>Observe marine organisms</strong> ‚Äî their status changes based on pH thresholds</li>
                        <li><strong>Study the chemical reaction</strong> showing how CO‚ÇÇ creates acid in seawater</li>
                        <li><strong>Test your understanding</strong> with the quiz at the bottom</li>
                    </ol>
                </div>
            </details>

            <!-- Main Simulation -->
            <div class="sim-grid">
                <!-- Control Panel -->
                <div class="control-panel">
                    <h3>üéõÔ∏è Time Travel Controls</h3>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Year</span>
                            <span class="control-value" id="year-display">2024</span>
                        </div>
                        <input type="range" id="year-slider" min="1800" max="2100" value="2024"
                               aria-label="Select year from 1800 to 2100">
                        <div class="year-markers">
                            <span>1800</span>
                            <span>1900</span>
                            <span>2000</span>
                            <span>2100</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control-label">
                            <span>Atmospheric CO‚ÇÇ</span>
                            <span class="control-value" id="co2-display">420 ppm</span>
                        </div>
                        <div style="background: var(--gray-200); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="co2-bar" style="background: var(--error); height: 100%; width: 50%; transition: width 0.3s;"></div>
                        </div>
                        <div class="year-markers">
                            <span>280 ppm</span>
                            <span>560 ppm</span>
                        </div>
                    </div>

                    <!-- pH Display -->
                    <div class="ph-display">
                        <div class="ph-label">Ocean pH</div>
                        <div class="ph-value" id="ph-display">8.10</div>
                        <div class="ph-change neutral" id="ph-change">Baseline: 8.25 (1800)</div>
                    </div>

                    <!-- pH Scale -->
                    <div class="ph-scale">
                        <div class="ph-marker" id="ph-marker" style="left: 58%;"></div>
                    </div>
                    <div class="ph-scale-labels">
                        <span>0 (Acid)</span>
                        <span>7 (Neutral)</span>
                        <span>14 (Base)</span>
                    </div>
                </div>

                <!-- Ocean Visualization -->
                <div class="ocean-viz" id="ocean-viz" role="img" aria-label="Ocean visualization showing marine organisms and their health status">
                    <div class="ocean-surface"></div>
                    <div class="organisms-grid">
                        <div class="organism-card healthy" id="coral-card">
                            <div class="organism-emoji">ü™∏</div>
                            <div class="organism-name">Coral</div>
                            <div class="organism-threshold">Threshold: pH 8.0</div>
                            <div class="organism-status status-healthy" id="coral-status">Healthy</div>
                        </div>
                        <div class="organism-card healthy" id="oyster-card">
                            <div class="organism-emoji">ü¶™</div>
                            <div class="organism-name">Oyster</div>
                            <div class="organism-threshold">Threshold: pH 7.9</div>
                            <div class="organism-status status-healthy" id="oyster-status">Healthy</div>
                        </div>
                        <div class="organism-card healthy" id="pteropod-card">
                            <div class="organism-emoji">üêö</div>
                            <div class="organism-name">Pteropod</div>
                            <div class="organism-threshold">Threshold: pH 7.8</div>
                            <div class="organism-status status-healthy" id="pteropod-status">Healthy</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chemical Reaction -->
            <div class="reaction-box">
                <h4>üß™ The Ocean Acidification Reaction</h4>
                <div class="reaction-equation">
                    <span class="molecule co2">CO‚ÇÇ</span>
                    <span class="arrow">+</span>
                    <span class="molecule h2o">H‚ÇÇO</span>
                    <span class="arrow">‚Üí</span>
                    <span class="molecule h2co3">H‚ÇÇCO‚ÇÉ</span>
                    <span class="arrow">‚Üí</span>
                    <span class="molecule h-ion">H‚Å∫</span>
                    <span class="arrow">+</span>
                    <span class="molecule hco3">HCO‚ÇÉ‚Åª</span>
                </div>
                <p class="reaction-note">
                    <strong>H‚Å∫ ions</strong> (hydrogen ions) make the water more acidic and interfere with shell formation
                </p>
            </div>

            <!-- Info Cards -->
            <div class="info-grid">
                <div class="info-card">
                    <h5>üìä Acidity Change from Baseline</h5>
                    <p><span class="big-number" id="acidity-change">0%</span></p>
                    <p>more acidic than 1800</p>
                </div>
                <div class="info-card">
                    <h5>‚ö†Ô∏è Organisms at Risk</h5>
                    <p><span class="big-number" id="organisms-at-risk">0/3</span></p>
                    <p>species below threshold</p>
                </div>
            </div>

            <!-- Key Concepts -->
            <div class="concept-box">
                <h4>üîë Key Concepts</h4>
                <div class="concept-grid">
                    <div class="concept-card">
                        <h5>Logarithmic Scale</h5>
                        <p>A 0.1 pH change = <strong>26% more acidic</strong>. Small numbers, big impact!</p>
                    </div>
                    <div class="concept-card">
                        <h5>Ocean as Carbon Sink</h5>
                        <p>Oceans absorb <strong>25%</strong> of human CO‚ÇÇ emissions ‚Äî good for climate, bad for marine life.</p>
                    </div>
                    <div class="concept-card">
                        <h5>Calcifying Organisms</h5>
                        <p>Shells and coral skeletons are made of <strong>calcium carbonate</strong>, which dissolves in acidic water.</p>
                    </div>
                    <div class="concept-card">
                        <h5>Threshold Effects</h5>
                        <p>Each species has a <strong>pH threshold</strong> below which it cannot survive or reproduce.</p>
                    </div>
                </div>
            </div>

            <!-- Quiz -->
            <div class="quiz-section">
                <div class="quiz-header">
                    <h4>‚úÖ Check Your Understanding</h4>
                    <button class="reset-btn" onclick="resetQuiz()">Try Again</button>
                </div>

                <div class="quiz-question">
                    <p><strong>Q1:</strong> If ocean pH drops from 8.1 to 8.0 (a change of 0.1), how much more acidic has the ocean become?</p>
                    <div class="quiz-options" role="group" aria-label="Question 1 options">
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 1)">0.1% more acidic</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 1)">10% more acidic</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, true, 1)">26% more acidic</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 1)">100% more acidic</button>
                    </div>
                    <div class="quiz-feedback" id="feedback-1" role="alert"></div>
                </div>

                <div class="quiz-question">
                    <p><strong>Q2:</strong> Which organism would be affected FIRST as ocean pH decreases?</p>
                    <div class="quiz-options" role="group" aria-label="Question 2 options">
                        <button class="quiz-btn" onclick="checkAnswer(this, true, 2)">Coral (threshold pH 8.0)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 2)">Oyster (threshold pH 7.9)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 2)">Pteropod (threshold pH 7.8)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 2)">All affected equally</button>
                    </div>
                    <div class="quiz-feedback" id="feedback-2" role="alert"></div>
                </div>

                <div class="quiz-question">
                    <p><strong>Q3:</strong> What chemical directly causes shells to dissolve?</p>
                    <div class="quiz-options" role="group" aria-label="Question 3 options">
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 3)">CO‚ÇÇ (carbon dioxide)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 3)">H‚ÇÇO (water)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, true, 3)">H‚Å∫ (hydrogen ions)</button>
                        <button class="quiz-btn" onclick="checkAnswer(this, false, 3)">HCO‚ÇÉ‚Åª (bicarbonate)</button>
                    </div>
                    <div class="quiz-feedback" id="feedback-3" role="alert"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data: Year ‚Üí CO2 (ppm) and pH
        const climateData = {
            1800: { co2: 280, ph: 8.25 },
            1850: { co2: 285, ph: 8.24 },
            1900: { co2: 295, ph: 8.21 },
            1950: { co2: 310, ph: 8.18 },
            1980: { co2: 340, ph: 8.14 },
            2000: { co2: 370, ph: 8.12 },
            2010: { co2: 390, ph: 8.11 },
            2020: { co2: 415, ph: 8.10 },
            2024: { co2: 420, ph: 8.09 },
            2050: { co2: 480, ph: 8.03 },
            2100: { co2: 560, ph: 7.95 }
        };

        // Organism thresholds
        const organisms = {
            coral: { threshold: 8.0, card: 'coral-card', status: 'coral-status' },
            oyster: { threshold: 7.9, card: 'oyster-card', status: 'oyster-status' },
            pteropod: { threshold: 7.8, card: 'pteropod-card', status: 'pteropod-status' }
        };

        // Interpolate data for any year
        function getDataForYear(year) {
            const years = Object.keys(climateData).map(Number).sort((a, b) => a - b);

            if (year <= years[0]) return climateData[years[0]];
            if (year >= years[years.length - 1]) return climateData[years[years.length - 1]];

            // Find surrounding years
            let lower = years[0], upper = years[years.length - 1];
            for (let i = 0; i < years.length - 1; i++) {
                if (year >= years[i] && year <= years[i + 1]) {
                    lower = years[i];
                    upper = years[i + 1];
                    break;
                }
            }

            // Linear interpolation
            const ratio = (year - lower) / (upper - lower);
            return {
                co2: Math.round(climateData[lower].co2 + (climateData[upper].co2 - climateData[lower].co2) * ratio),
                ph: +(climateData[lower].ph + (climateData[upper].ph - climateData[lower].ph) * ratio).toFixed(2)
            };
        }

        // Update display
        function updateSimulation(year) {
            const data = getDataForYear(year);
            const baseline = climateData[1800];

            // Update year display
            document.getElementById('year-display').textContent = year;

            // Update CO2
            document.getElementById('co2-display').textContent = data.co2 + ' ppm';
            const co2Percent = ((data.co2 - 280) / (560 - 280)) * 100;
            document.getElementById('co2-bar').style.width = co2Percent + '%';

            // Update pH
            document.getElementById('ph-display').textContent = data.ph.toFixed(2);

            // pH change display
            const phDiff = (baseline.ph - data.ph).toFixed(2);
            const phChangeEl = document.getElementById('ph-change');
            if (phDiff > 0) {
                const acidityIncrease = Math.round((Math.pow(10, phDiff) - 1) * 100);
                phChangeEl.textContent = `${acidityIncrease}% more acidic than 1800`;
                phChangeEl.className = 'ph-change negative';
                document.getElementById('acidity-change').textContent = acidityIncrease + '%';
            } else {
                phChangeEl.textContent = 'Baseline: 8.25 (1800)';
                phChangeEl.className = 'ph-change neutral';
                document.getElementById('acidity-change').textContent = '0%';
            }

            // Update pH marker position (pH 0-14 scale)
            const markerPos = (data.ph / 14) * 100;
            document.getElementById('ph-marker').style.left = markerPos + '%';

            // Update organisms
            let atRisk = 0;
            for (const [name, org] of Object.entries(organisms)) {
                const card = document.getElementById(org.card);
                const status = document.getElementById(org.status);

                if (data.ph >= org.threshold + 0.05) {
                    card.className = 'organism-card healthy';
                    status.className = 'organism-status status-healthy';
                    status.textContent = 'Healthy';
                } else if (data.ph >= org.threshold) {
                    card.className = 'organism-card stressed';
                    status.className = 'organism-status status-stressed';
                    status.textContent = 'Stressed';
                } else {
                    card.className = 'organism-card critical';
                    status.className = 'organism-status status-critical';
                    status.textContent = 'Critical!';
                    atRisk++;
                }
            }

            document.getElementById('organisms-at-risk').textContent = atRisk + '/3';

            // Create bubbles based on CO2 level
            createBubbles(data.co2);
        }

        // Create CO2 bubbles
        let bubbleInterval;
        function createBubbles(co2) {
            const ocean = document.getElementById('ocean-viz');

            // Clear existing bubbles
            ocean.querySelectorAll('.bubble').forEach(b => b.remove());

            // Create new bubbles proportional to CO2
            const bubbleCount = Math.floor((co2 - 280) / 20);

            for (let i = 0; i < Math.min(bubbleCount, 15); i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    const size = 8 + Math.random() * 12;
                    bubble.style.width = size + 'px';
                    bubble.style.height = size + 'px';
                    bubble.style.left = (10 + Math.random() * 80) + '%';
                    bubble.style.bottom = '10px';
                    bubble.style.animationDelay = (Math.random() * 2) + 's';
                    ocean.appendChild(bubble);

                    // Remove after animation
                    setTimeout(() => bubble.remove(), 3000);
                }, i * 200);
            }
        }

        // Quiz functions
        const quizFeedback = {
            1: {
                correct: "Correct! The pH scale is logarithmic. A 0.1 change means 10^0.1 ‚âà 1.26, or 26% more hydrogen ions (more acidic).",
                incorrect: "Not quite. The pH scale is logarithmic, so a 0.1 change = 10^0.1 ‚âà 1.26 = 26% more acidic. Small pH changes are actually big chemistry changes!"
            },
            2: {
                correct: "Correct! Coral has the highest pH threshold (8.0), so it's affected first as pH drops from the baseline of 8.25.",
                incorrect: "Not quite. Look at the thresholds: Coral needs pH 8.0, Oyster needs 7.9, Pteropod needs 7.8. As pH drops from 8.25, coral hits its threshold first!"
            },
            3: {
                correct: "Correct! H‚Å∫ (hydrogen ions) released when carbonic acid breaks apart are what actually dissolve calcium carbonate shells.",
                incorrect: "Not quite. While CO‚ÇÇ starts the process, it's the H‚Å∫ (hydrogen ions) from the reaction CO‚ÇÇ + H‚ÇÇO ‚Üí H‚ÇÇCO‚ÇÉ ‚Üí H‚Å∫ + HCO‚ÇÉ‚Åª that actually attack shells."
            }
        };

        function checkAnswer(btn, isCorrect, qNum) {
            const feedback = document.getElementById('feedback-' + qNum);
            const buttons = btn.parentElement.querySelectorAll('.quiz-btn');

            buttons.forEach(b => {
                b.disabled = true;
                if (b === btn) {
                    b.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });

            feedback.textContent = isCorrect ? quizFeedback[qNum].correct : quizFeedback[qNum].incorrect;
            feedback.className = 'quiz-feedback show ' + (isCorrect ? 'correct' : 'incorrect');
        }

        function resetQuiz() {
            document.querySelectorAll('.quiz-btn').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('correct', 'incorrect');
            });
            document.querySelectorAll('.quiz-feedback').forEach(fb => {
                fb.className = 'quiz-feedback';
                fb.textContent = '';
            });
        }

        // Initialize
        const slider = document.getElementById('year-slider');
        slider.addEventListener('input', (e) => updateSimulation(parseInt(e.target.value)));

        // Keyboard accessibility for slider
        slider.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {
                slider.value = Math.min(2100, parseInt(slider.value) + 10);
                updateSimulation(parseInt(slider.value));
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
                slider.value = Math.max(1800, parseInt(slider.value) - 10);
                updateSimulation(parseInt(slider.value));
            }
        });

        // Initial render
        updateSimulation(2024);

        // Continuous bubble animation (respects reduced motion preference)
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (!prefersReducedMotion) {
            setInterval(() => {
                const year = parseInt(slider.value);
                const data = getDataForYear(year);
                createBubbles(data.co2);
            }, 3000);
        }
    </script>
</body>
</html>
