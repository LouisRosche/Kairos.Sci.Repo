<!--
================================================================================
‚õî READ-ONLY PRODUCTION CONTENT - DO NOT EDIT ‚õî
================================================================================
This file is PRODUCTION content deployed December 2025.
It serves as legacy documentation and must NOT be modified.
Any changes risk breaking deployed student-facing materials.

Status: READONLY | Deployed: December 2025 | See: cycle-status.json
================================================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive transitional form designer - predict evolutionary intermediate features based on ancestor and descendant characteristics">
    <title>Transitional Form Designer - Predict Evolution</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --primary: #0D9488;
            --primary-dark: #0F766E;
            --primary-light: #CCFBF1;
            --accent: #7C3AED;
            --accent-light: #EDE9FE;
            --success: #10B981;
            --success-light: #D1FAE5;
            --error: #EF4444;
            --error-light: #FEE2E2;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --info: #3B82F6;
            --info-light: #DBEAFE;
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1E293B;
            --gray-900: #0F172A;
            --text: #1E293B;
            --text-muted: #64748B;
            --radius: 10px;
            --radius-sm: 6px;
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0F766E 0%, #134E4A 100%);
            min-height: 100vh;
            padding: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 6px;
            font-size: clamp(1.3em, 3.5vw, 1.7em);
        }

        .subtitle {
            text-align: center;
            color: #99F6E4;
            margin-bottom: 12px;
            font-size: 0.85em;
        }

        .sim-container {
            background: #fff;
            border-radius: var(--radius);
            padding: 14px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.25);
        }

        /* Instructions Panel */
        .instructions {
            background: var(--primary-light);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 14px;
        }

        .instructions summary {
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-dark);
            font-size: 0.9em;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .instructions summary::-webkit-details-marker { display: none; }
        .instructions[open] summary { margin-bottom: 10px; }

        .instructions-content {
            color: #115E59;
            font-size: 0.82em;
            line-height: 1.6;
        }

        .instructions-content p { margin-bottom: 6px; }
        .instructions-content p:last-child { margin-bottom: 0; }

        /* Scenario Selector */
        .scenario-selector {
            background: var(--primary-light);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 14px;
        }

        .scenario-selector h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            text-align: center;
            font-size: 0.95em;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .scenario-grid { grid-template-columns: 1fr; }
        }

        .scenario-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .scenario-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .scenario-card:focus {
            outline: 3px solid var(--primary);
            outline-offset: 2px;
        }

        .scenario-card.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .scenario-card .title { font-weight: bold; color: var(--text); margin-bottom: 3px; font-size: 0.85em; }
        .scenario-card .desc { font-size: 0.72em; color: var(--text-muted); }

        /* Evolution Timeline */
        .evolution-timeline {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            gap: 8px;
            align-items: center;
            margin-bottom: 14px;
            padding: 14px;
            background: var(--gray-50);
            border-radius: var(--radius);
        }

        @media (max-width: 650px) {
            .evolution-timeline {
                grid-template-columns: 1fr;
                gap: 6px;
                text-align: center;
            }
            .arrow {
                transform: rotate(90deg);
                font-size: 1.2em !important;
            }
        }

        .organism-box {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius);
            padding: 12px 8px;
            text-align: center;
        }

        .organism-box.ancestor { border-color: var(--warning); background: var(--warning-light); }
        .organism-box.transitional { border-color: var(--accent); background: var(--accent-light); }
        .organism-box.descendant { border-color: var(--success); background: var(--success-light); }

        .organism-box .emoji { font-size: 2.2em; margin-bottom: 4px; }
        .organism-box .name { font-weight: bold; color: var(--text); font-size: 0.82em; }
        .organism-box .time { font-size: 0.7em; color: var(--text-muted); margin-top: 2px; }

        .arrow {
            font-size: 1.5em;
            color: #94A3B8;
            text-align: center;
        }

        /* Designer Panel */
        .designer-panel {
            background: var(--accent-light);
            border: 2px solid var(--accent);
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 14px;
        }

        .designer-panel h3 {
            color: #5B21B6;
            margin-bottom: 8px;
            text-align: center;
            font-size: 0.95em;
        }

        .designer-intro {
            text-align: center;
            color: #5B21B6;
            margin-bottom: 12px;
            font-size: 0.82em;
        }

        .trait-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (max-width: 700px) {
            .trait-grid { grid-template-columns: 1fr; }
        }

        .trait-selector {
            background: white;
            border-radius: var(--radius);
            padding: 12px;
            border: 2px solid var(--gray-200);
        }

        .trait-selector h4 {
            color: var(--text);
            margin-bottom: 8px;
            font-size: 0.85em;
        }

        .trait-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .trait-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        .trait-option:hover { background: var(--gray-50); }
        .trait-option:focus { outline: 2px solid var(--accent); outline-offset: 1px; }

        .trait-option.selected {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .trait-option.correct {
            border-color: var(--success);
            background: var(--success-light);
        }

        .trait-option.incorrect {
            border-color: var(--error);
            background: var(--error-light);
        }

        .trait-option input { display: none; }
        .trait-icon { font-size: 1.3em; flex-shrink: 0; }

        .trait-label { flex: 1; min-width: 0; }
        .trait-label .name { font-weight: 600; color: var(--text); font-size: 0.8em; }
        .trait-label .desc { font-size: 0.7em; color: var(--text-muted); }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .check-btn, .reset-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .check-btn {
            background: linear-gradient(135deg, var(--accent), #6D28D9);
            color: white;
        }

        .check-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .check-btn:focus { outline: 3px solid var(--accent); outline-offset: 2px; }
        .check-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .reset-btn {
            background: var(--gray-200);
            color: var(--text);
            display: none;
        }

        .reset-btn:hover { background: var(--gray-100); }
        .reset-btn:focus { outline: 3px solid var(--gray-600); outline-offset: 2px; }
        .reset-btn.show { display: block; }

        /* Result Panel */
        .result-panel {
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 12px;
            display: none;
        }

        .result-panel.show { display: block; }

        .result-panel.success {
            background: linear-gradient(135deg, var(--success-light), #A7F3D0);
            border: 2px solid var(--success);
        }

        .result-panel.partial {
            background: linear-gradient(135deg, var(--warning-light), #FDE68A);
            border: 2px solid var(--warning);
        }

        .result-panel h3 { margin-bottom: 6px; font-size: 0.95em; }
        .result-panel.success h3 { color: #047857; }
        .result-panel.partial h3 { color: #92400E; }
        .result-panel p { line-height: 1.5; font-size: 0.82em; }
        .result-panel.success p { color: #065F46; }
        .result-panel.partial p { color: #78350F; }

        /* Score Display */
        .score-display {
            text-align: center;
            font-size: 1em;
            color: #5B21B6;
            margin: 10px 0;
            font-weight: 600;
        }

        /* Real Fossil Panel */
        .real-fossil {
            background: var(--info-light);
            border: 2px solid var(--info);
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 12px;
            display: none;
        }

        .real-fossil.show { display: block; }
        .real-fossil h4 { color: #1D4ED8; margin-bottom: 8px; font-size: 0.9em; }
        .real-fossil p { color: #1E40AF; font-size: 0.82em; line-height: 1.5; }

        .fossil-traits {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .fossil-trait {
            background: #BFDBFE;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            color: #1E40AF;
        }

        /* Key Concept */
        .key-concept {
            background: linear-gradient(135deg, var(--warning-light), #FDE68A);
            border: 2px solid var(--warning);
            border-radius: var(--radius);
            padding: 14px;
        }

        .key-concept h4 { color: #92400E; margin-bottom: 6px; font-size: 0.9em; }
        .key-concept p { color: #78350F; line-height: 1.5; font-size: 0.82em; }

        /* Try Another Prompt */
        .try-another {
            background: var(--primary-light);
            border: 2px solid var(--primary);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 12px;
            text-align: center;
            display: none;
        }

        .try-another.show { display: block; }
        .try-another p { color: var(--primary-dark); font-size: 0.85em; margin-bottom: 8px; }

        .try-another-btn {
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.82em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .try-another-btn:hover { background: var(--primary-dark); }
        .try-another-btn:focus { outline: 2px solid var(--primary); outline-offset: 2px; }

        /* Print styles */
        @media print {
            body { background: white; padding: 0; }
            .sim-container { box-shadow: none; }
            .instructions, .designer-panel { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Transitional Form Designer</h1>
        <p class="subtitle">Predict what a transitional fossil would look like based on ancestor and descendant!</p>

        <div class="sim-container">
            <details class="instructions">
                <summary role="button" aria-expanded="false">How to Use This Simulation</summary>
                <div class="instructions-content">
                    <p><strong>Step 1:</strong> Choose an evolutionary transition (Fish to Tetrapod, Dinosaur to Bird, or Land Mammal to Whale).</p>
                    <p><strong>Step 2:</strong> For each trait, select what you think the transitional form would have (between ancestor and descendant).</p>
                    <p><strong>Step 3:</strong> Click "Check My Prediction" to see how your prediction compares to the real fossil!</p>
                    <p><strong>Key concept:</strong> Transitional forms have INTERMEDIATE features - not fully ancestral, not fully descendant, but IN BETWEEN.</p>
                </div>
            </details>

            <div class="scenario-selector">
                <h3>Choose an Evolutionary Transition</h3>
                <div class="scenario-grid" role="group" aria-label="Select evolutionary scenario">
                    <button class="scenario-card selected" onclick="selectScenario('fish-tetrapod')" id="scenario-fish-tetrapod" aria-pressed="true">
                        <div class="title">Fish to Tetrapod</div>
                        <div class="desc">Water to land (~375 MYA)</div>
                    </button>
                    <button class="scenario-card" onclick="selectScenario('dino-bird')" id="scenario-dino-bird" aria-pressed="false">
                        <div class="title">Dinosaur to Bird</div>
                        <div class="desc">Ground to air (~150 MYA)</div>
                    </button>
                    <button class="scenario-card" onclick="selectScenario('land-whale')" id="scenario-land-whale" aria-pressed="false">
                        <div class="title">Land Mammal to Whale</div>
                        <div class="desc">Land to water (~50 MYA)</div>
                    </button>
                </div>
            </div>

            <div class="evolution-timeline" id="timeline" role="region" aria-label="Evolution timeline">
                <div class="organism-box ancestor" id="ancestor">
                    <div class="emoji" aria-hidden="true">üêü</div>
                    <div class="name">Lobe-finned Fish</div>
                    <div class="time">~385 million years ago</div>
                </div>
                <div class="arrow" aria-hidden="true">‚Üí</div>
                <div class="organism-box transitional" id="transitional">
                    <div class="emoji" aria-hidden="true">‚ùì</div>
                    <div class="name">Your Prediction</div>
                    <div class="time">Transitional Form</div>
                </div>
                <div class="arrow" aria-hidden="true">‚Üí</div>
                <div class="organism-box descendant" id="descendant">
                    <div class="emoji" aria-hidden="true">ü¶é</div>
                    <div class="name">Early Tetrapod</div>
                    <div class="time">~365 million years ago</div>
                </div>
            </div>

            <div class="designer-panel">
                <h3>Design Your Transitional Form</h3>
                <p class="designer-intro">What features would an organism "in between" have? Select one option for each trait:</p>
                <div class="trait-grid" id="trait-grid" role="group" aria-label="Trait selection"></div>
                <div class="btn-group">
                    <button class="check-btn" onclick="checkDesign()" id="check-btn" aria-label="Check my prediction">Check My Prediction</button>
                    <button class="reset-btn" onclick="resetDesign()" id="reset-btn" aria-label="Try again with this scenario">Try Again</button>
                </div>
            </div>

            <div class="score-display" id="score-display" aria-live="polite"></div>

            <div class="result-panel" id="result-panel" role="alert">
                <h3 id="result-title"></h3>
                <p id="result-text"></p>
            </div>

            <div class="try-another" id="try-another">
                <p>Want to try a different evolutionary transition?</p>
                <button class="try-another-btn" onclick="promptTryAnother()">Try Another Scenario</button>
            </div>

            <div class="real-fossil" id="real-fossil">
                <h4>The Real Transitional Fossil</h4>
                <p id="fossil-description"></p>
                <div class="fossil-traits" id="fossil-traits"></div>
            </div>

            <div class="key-concept">
                <h4>Why Transitional Forms Matter</h4>
                <p>
                    Transitional fossils show us evolution "caught in the act." They have a MIX of features from
                    both ancestral and descendant groups. Scientists predicted these forms would exist BEFORE
                    finding them - proving that evolution makes testable predictions! When you design a transitional
                    form, you're doing the same thing paleontologists do.
                </p>
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            'fish-tetrapod': {
                ancestor: { emoji: 'üêü', name: 'Lobe-finned Fish', time: '~385 million years ago' },
                descendant: { emoji: 'ü¶é', name: 'Early Tetrapod', time: '~365 million years ago' },
                transitional: { emoji: 'üêä', name: 'Tiktaalik', time: '~375 million years ago' },
                traits: [
                    {
                        name: 'Limbs',
                        options: [
                            { id: 'fins', icon: 'üèä', name: 'True fins', desc: 'Like fish - for swimming', correct: false },
                            { id: 'finlegs', icon: 'ü¶ø', name: 'Fin-legs', desc: 'Fins with wrist bones', correct: true },
                            { id: 'legs', icon: 'ü¶µ', name: 'True legs', desc: 'Like lizards - for walking', correct: false }
                        ]
                    },
                    {
                        name: 'Breathing',
                        options: [
                            { id: 'gills', icon: 'ü´Å', name: 'Only gills', desc: 'Breathe underwater only', correct: false },
                            { id: 'both', icon: 'üîÑ', name: 'Gills AND lungs', desc: 'Can breathe in both', correct: true },
                            { id: 'lungs', icon: 'üí®', name: 'Only lungs', desc: 'Breathe air only', correct: false }
                        ]
                    },
                    {
                        name: 'Head/Neck',
                        options: [
                            { id: 'fused', icon: 'üêü', name: 'Head fused', desc: 'Like fish - no neck', correct: false },
                            { id: 'neck', icon: 'ü¶é', name: 'Moveable neck', desc: 'Can turn head', correct: true },
                            { id: 'long', icon: 'ü¶ï', name: 'Long neck', desc: 'Like a dinosaur', correct: false }
                        ]
                    },
                    {
                        name: 'Habitat',
                        options: [
                            { id: 'deep', icon: 'üåä', name: 'Deep ocean', desc: 'Open water swimmer', correct: false },
                            { id: 'shallow', icon: 'üèùÔ∏è', name: 'Shallow water', desc: 'Swamps and shorelines', correct: true },
                            { id: 'land', icon: 'üèúÔ∏è', name: 'Dry land', desc: 'Lives on land', correct: false }
                        ]
                    }
                ],
                fossilDescription: 'Tiktaalik was discovered in 2004 in Arctic Canada. Scientists PREDICTED they would find a fish-tetrapod transitional form in 375-million-year-old rocks - and they were right!',
                fossilTraits: ['Fins with wrist & finger bones', 'Gills AND primitive lungs', 'Flat head with eyes on top', 'Neck that could move', 'Ribs for supporting body on land']
            },
            'dino-bird': {
                ancestor: { emoji: 'ü¶ñ', name: 'Theropod Dinosaur', time: '~160 million years ago' },
                descendant: { emoji: 'üê¶', name: 'Modern Bird', time: 'Present day' },
                transitional: { emoji: 'ü¶Ö', name: 'Archaeopteryx', time: '~150 million years ago' },
                traits: [
                    {
                        name: 'Body Covering',
                        options: [
                            { id: 'scales', icon: 'ü¶é', name: 'Only scales', desc: 'Like reptiles', correct: false },
                            { id: 'feathers', icon: 'ü™∂', name: 'Feathers', desc: 'Full feather covering', correct: true },
                            { id: 'both', icon: 'üîÑ', name: 'Scales AND feathers', desc: 'Mix of both', correct: false }
                        ]
                    },
                    {
                        name: 'Mouth',
                        options: [
                            { id: 'teeth', icon: 'ü¶∑', name: 'Teeth in jaws', desc: 'Like dinosaurs', correct: true },
                            { id: 'beak', icon: 'üê¶', name: 'Toothless beak', desc: 'Like modern birds', correct: false },
                            { id: 'mixed', icon: 'üîÑ', name: 'Beak with teeth', desc: 'Partial beak', correct: false }
                        ]
                    },
                    {
                        name: 'Forelimbs',
                        options: [
                            { id: 'arms', icon: 'üí™', name: 'Clawed arms', desc: 'For grabbing prey', correct: false },
                            { id: 'wings-claws', icon: 'ü¶á', name: 'Wings WITH claws', desc: 'Can fly but has claws', correct: true },
                            { id: 'wings', icon: 'üïäÔ∏è', name: 'True wings', desc: 'No claws, only flying', correct: false }
                        ]
                    },
                    {
                        name: 'Tail',
                        options: [
                            { id: 'long', icon: 'ü¶é', name: 'Long bony tail', desc: 'Like dinosaurs', correct: true },
                            { id: 'short', icon: 'üê¶', name: 'Short pygostyle', desc: 'Fused like birds', correct: false },
                            { id: 'none', icon: '‚ùå', name: 'No tail', desc: 'Completely lost', correct: false }
                        ]
                    }
                ],
                fossilDescription: 'Archaeopteryx was found in Germany in 1861, just 2 years after Darwin published Origin of Species. It was exactly the dinosaur-bird transitional form his theory predicted!',
                fossilTraits: ['Full feathers on body and wings', 'Teeth in jaws (not a beak)', 'Wings with 3 clawed fingers', 'Long bony tail with feathers', 'Wishbone like birds']
            },
            'land-whale': {
                ancestor: { emoji: 'üêï', name: 'Pakicetus', time: '~50 million years ago' },
                descendant: { emoji: 'üêã', name: 'Modern Whale', time: 'Present day' },
                transitional: { emoji: 'ü¶≠', name: 'Ambulocetus', time: '~48 million years ago' },
                traits: [
                    {
                        name: 'Legs',
                        options: [
                            { id: 'four', icon: 'üêï', name: 'Four walking legs', desc: 'Fully terrestrial', correct: false },
                            { id: 'paddle', icon: 'ü¶≠', name: 'Paddle-like legs', desc: 'Short with webbed feet', correct: true },
                            { id: 'flippers', icon: 'üêã', name: 'Flippers only', desc: 'No hind limbs', correct: false }
                        ]
                    },
                    {
                        name: 'Tail',
                        options: [
                            { id: 'dog', icon: 'üêï', name: 'Regular tail', desc: 'Like a dog tail', correct: false },
                            { id: 'otter', icon: 'ü¶¶', name: 'Thick muscular', desc: 'For swimming', correct: true },
                            { id: 'fluke', icon: 'üêã', name: 'Horizontal fluke', desc: 'Like modern whales', correct: false }
                        ]
                    },
                    {
                        name: 'Nostrils',
                        options: [
                            { id: 'front', icon: 'üêï', name: 'Front of snout', desc: 'Like land mammals', correct: false },
                            { id: 'middle', icon: 'ü¶≠', name: 'Partway up snout', desc: 'Moving toward top', correct: true },
                            { id: 'top', icon: 'üêã', name: 'Top of head', desc: 'Blowhole', correct: false }
                        ]
                    },
                    {
                        name: 'Habitat',
                        options: [
                            { id: 'land', icon: 'üèúÔ∏è', name: 'Fully land', desc: 'Lives on land only', correct: false },
                            { id: 'semi', icon: 'üèä', name: 'Semi-aquatic', desc: 'Rivers and shores', correct: true },
                            { id: 'ocean', icon: 'üåä', name: 'Fully aquatic', desc: 'Open ocean only', correct: false }
                        ]
                    }
                ],
                fossilDescription: 'Ambulocetus ("walking whale") was discovered in Pakistan in 1994. Its name means "walking whale" because it could both walk on land AND swim - exactly what we\'d expect in a land-to-water transition!',
                fossilTraits: ['Short paddle-like legs with webbed feet', 'Powerful tail for swimming', 'Nostrils partway up snout', 'Could walk on land awkwardly', 'Hunted like a crocodile']
            }
        };

        let currentScenario = 'fish-tetrapod';
        let selections = {};
        let hasChecked = false;

        function selectScenario(scenario) {
            if (hasChecked) {
                // Reset if already checked
                resetDesign();
            }

            currentScenario = scenario;
            selections = {};

            // Update UI
            document.querySelectorAll('.scenario-card').forEach(c => {
                c.classList.remove('selected');
                c.setAttribute('aria-pressed', 'false');
            });
            const selectedCard = document.getElementById(`scenario-${scenario}`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                selectedCard.setAttribute('aria-pressed', 'true');
            }

            // Update timeline
            const s = scenarios[scenario];
            document.getElementById('ancestor').innerHTML = `
                <div class="emoji" aria-hidden="true">${s.ancestor.emoji}</div>
                <div class="name">${s.ancestor.name}</div>
                <div class="time">${s.ancestor.time}</div>
            `;
            document.getElementById('descendant').innerHTML = `
                <div class="emoji" aria-hidden="true">${s.descendant.emoji}</div>
                <div class="name">${s.descendant.name}</div>
                <div class="time">${s.descendant.time}</div>
            `;
            document.getElementById('transitional').innerHTML = `
                <div class="emoji" aria-hidden="true">‚ùì</div>
                <div class="name">Your Prediction</div>
                <div class="time">Transitional Form</div>
            `;

            buildTraitGrid();
            hideResults();
        }

        function buildTraitGrid() {
            const grid = document.getElementById('trait-grid');
            const s = scenarios[currentScenario];

            grid.innerHTML = s.traits.map((trait, i) => `
                <div class="trait-selector">
                    <h4>${trait.name}</h4>
                    <div class="trait-options" role="radiogroup" aria-label="${trait.name} options">
                        ${trait.options.map(opt => `
                            <button class="trait-option"
                                    id="opt-${i}-${opt.id}"
                                    onclick="selectTrait(${i}, '${opt.id}')"
                                    role="radio"
                                    aria-checked="false"
                                    aria-label="${opt.name}: ${opt.desc}">
                                <span class="trait-icon" aria-hidden="true">${opt.icon}</span>
                                <span class="trait-label">
                                    <div class="name">${opt.name}</div>
                                    <div class="desc">${opt.desc}</div>
                                </span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function selectTrait(traitIndex, optionId) {
            if (hasChecked) return; // Don't allow changes after checking

            selections[traitIndex] = optionId;

            // Update UI
            const s = scenarios[currentScenario];
            s.traits[traitIndex].options.forEach(opt => {
                const el = document.getElementById(`opt-${traitIndex}-${opt.id}`);
                if (el) {
                    el.classList.remove('selected');
                    el.setAttribute('aria-checked', 'false');
                }
            });

            const selectedEl = document.getElementById(`opt-${traitIndex}-${optionId}`);
            if (selectedEl) {
                selectedEl.classList.add('selected');
                selectedEl.setAttribute('aria-checked', 'true');
            }
        }

        function checkDesign() {
            const s = scenarios[currentScenario];
            let correct = 0;
            const total = s.traits.length;

            // Check each trait
            s.traits.forEach((trait, i) => {
                trait.options.forEach(opt => {
                    const el = document.getElementById(`opt-${i}-${opt.id}`);
                    if (el) {
                        el.classList.remove('correct', 'incorrect', 'selected');

                        if (opt.correct) {
                            el.classList.add('correct');
                        }
                        if (selections[i] === opt.id && !opt.correct) {
                            el.classList.add('incorrect');
                        }
                    }
                });

                // Count correct
                const selected = selections[i];
                const correctOpt = trait.options.find(o => o.correct);
                if (selected === correctOpt.id) {
                    correct++;
                }
            });

            // Show score
            document.getElementById('score-display').textContent = `Score: ${correct}/${total} traits correct`;

            // Show result
            const resultPanel = document.getElementById('result-panel');
            resultPanel.classList.add('show');

            if (correct === total) {
                resultPanel.classList.remove('partial');
                resultPanel.classList.add('success');
                document.getElementById('result-title').textContent = 'Perfect Prediction!';
                document.getElementById('result-text').textContent =
                    `Amazing! You correctly predicted all ${total} traits of the transitional form. You thought like a paleontologist! Transitional forms have a MIX of ancestral and descendant features - that's exactly what makes them "transitional."`;
            } else {
                resultPanel.classList.remove('success');
                resultPanel.classList.add('partial');
                document.getElementById('result-title').textContent = `${correct}/${total} Correct`;
                document.getElementById('result-text').textContent =
                    `Good effort! Remember: transitional forms have INTERMEDIATE features - not fully ancestral, not fully descendant, but IN BETWEEN. The green options show what scientists actually found in the fossil record.`;
            }

            // Update transitional box
            document.getElementById('transitional').innerHTML = `
                <div class="emoji" aria-hidden="true">${s.transitional.emoji}</div>
                <div class="name">${s.transitional.name}</div>
                <div class="time">${s.transitional.time}</div>
            `;

            // Show real fossil info
            const fossilPanel = document.getElementById('real-fossil');
            fossilPanel.classList.add('show');
            document.getElementById('fossil-description').textContent = s.fossilDescription;
            document.getElementById('fossil-traits').innerHTML = s.fossilTraits.map(t =>
                `<span class="fossil-trait">‚úì ${t}</span>`
            ).join('');

            // Show try another and reset buttons
            document.getElementById('try-another').classList.add('show');
            document.getElementById('reset-btn').classList.add('show');
            document.getElementById('check-btn').disabled = true;

            hasChecked = true;
        }

        function resetDesign() {
            const s = scenarios[currentScenario];
            selections = {};
            hasChecked = false;

            // Reset trait options
            s.traits.forEach((trait, i) => {
                trait.options.forEach(opt => {
                    const el = document.getElementById(`opt-${i}-${opt.id}`);
                    if (el) {
                        el.classList.remove('selected', 'correct', 'incorrect');
                        el.setAttribute('aria-checked', 'false');
                    }
                });
            });

            // Reset transitional box
            document.getElementById('transitional').innerHTML = `
                <div class="emoji" aria-hidden="true">‚ùì</div>
                <div class="name">Your Prediction</div>
                <div class="time">Transitional Form</div>
            `;

            hideResults();
        }

        function hideResults() {
            document.getElementById('result-panel').classList.remove('show');
            document.getElementById('real-fossil').classList.remove('show');
            document.getElementById('try-another').classList.remove('show');
            document.getElementById('reset-btn').classList.remove('show');
            document.getElementById('score-display').textContent = '';
            document.getElementById('check-btn').disabled = false;
            hasChecked = false;
        }

        function promptTryAnother() {
            // Find next scenario
            const scenarioKeys = Object.keys(scenarios);
            const currentIndex = scenarioKeys.indexOf(currentScenario);
            const nextIndex = (currentIndex + 1) % scenarioKeys.length;
            const nextScenario = scenarioKeys[nextIndex];

            selectScenario(nextScenario);

            // Scroll to top of scenario selector
            document.querySelector('.scenario-selector').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Keyboard navigation for scenario cards
        document.querySelectorAll('.scenario-card').forEach(card => {
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    card.click();
                }
            });
        });

        // Initialize
        selectScenario('fish-tetrapod');
    </script>
</body>
</html>
